# 대용량 웹 시스템 아키텍처의 이해

## 웹 서버와 웹 애플리케이션의 분리

웹 서버와 웹 애플리케이션이 분리되는 이유는 다음과 같습니다:

- **관심사의 분리**: 각 컴포넌트가 특정 역할에 집중하도록 하여 유지보수를 용이하게 함
- **관측가능한 시스템**: 문제 발생 시 원인을 쉽게 파악하고 대응할 수 있음
- **효율적인 리소스 사용**: 각 컴포넌트가 필요한 자원을 효율적으로 사용하도록 함

기본 웹 아키텍처는 점점 늘어나는 대용량 데이터를 처리하는 데 한계가 있습니다.

## 데이터베이스가 병목이 되는 이유

### 스케일 업 (Scale Up)

서버의 용량을 증가시키는 방식입니다.

### 스케일 아웃 (Scale Out)

서버의 개수를 늘리는 방식입니다.

|  | 스케일 업 | 스케일 아웃 |
| --- | --- | --- |
| 유지보수 및 관리 | 쉬움 | 여러 노드에 적절히 부하 분산 필요 |
| 확장성 | 제약이 있음 | 스케일 업에 비해 자유로움 |
| 장애복구 | 서버가 1대, 다운타임 발생 가능 | 장애 탄력성이 있음 |

데이터베이스는 데이터라는 상태를 관리하고 있기 때문에, 서버보다 스케일 아웃을 하기 위해서는 훨씬 많은 비용이 듭니다. 또한 데이터베이스는 디스크의 데이터를 접근해서 가져오기 때문에 병목 현상이 발생할 수 있습니다.

## 대용량 시스템 아키텍처

대용량 시스템에서는 하나의 서버 또는 데이터베이스로는 감당하기 힘든 부하가 발생합니다. 이를 해결하기 위해 다수의 서버와 데이터베이스를 마치 하나인 것처럼 운영하며, 웹 서비스들은 24시간 무중단으로 운영되어야 합니다. 잘못된 코드 한 줄이 미치는 영향의 범위가 크기 때문에 복잡한 의존 관계를 관리하는 것이 중요합니다.

### 대용량 서버가 갖춰야 할 요소

- **고가용성**: 언제든 서비스를 이용할 수 있어야 합니다.
- **확장성**: 시스템이 비대해짐에 따라 증가하는 데이터와 트래픽에 대응할 수 있어야 합니다.
- **관측가능성**: 문제가 생겼을 때 빠르게 인지하고 문제의 범위를 최소화할 수 있어야 합니다.

## 로드밸런서

로드밸런서는 여러 서버에 걸쳐 네트워크 트래픽을 분산시켜 웹 애플리케이션의 성능과 가용성을 향상시키는 장치나 소프트웨어입니다. 로드밸런서를 사용하면 단일 서버에 과부하가 걸리는 것을 방지하고, 시스템의 확장성과 신뢰성을 높일 수 있습니다.

### 로드밸런서의 주요 기능

1. **부하 분산**: 클라이언트 요청을 여러 서버에 분산시켜 각 서버가 적절한 양의 트래픽만 처리하도록 합니다.
2. **장애 감지 및 복구**: 서버의 상태를 모니터링하고, 장애가 발생한 서버를 자동으로 제외시켜 서비스 중단을 방지합니다.
3. **세션 지속성**: 특정 클라이언트의 요청을 동일한 서버로 지속적으로 전달하여 세션 데이터를 유지합니다.
4. **SSL 종료**: SSL/TLS 암호화를 로드밸런서에서 처리하여 백엔드 서버의 부담을 줄입니다.
5. **동적 트래픽 관리**: 트래픽의 양과 서버의 상태에 따라 동적으로 트래픽을 조절합니다.

### 로드밸런싱 알고리즘

로드밸런서는 다양한 알고리즘을 사용하여 트래픽을 분산시킵니다. 주요 알고리즘은 다음과 같습니다:

- **라운드 로빈 (Round Robin)**: 가장 기본적인 방법으로, 각 서버에 순차적으로 요청을 분배합니다.
- **가중치 라운드 로빈 (Weighted Round Robin)**: 각 서버에 가중치를 부여하여, 더 강력한 서버에 더 많은 요청을 보냅니다.
- **최소 연결 (Least Connections)**: 현재 연결 수가 가장 적은 서버로 요청을 보냅니다.
- **최소 응답 시간 (Least Response Time)**: 응답 시간이 가장 빠른 서버로 요청을 보냅니다.
- **IP 해시 (IP Hash)**: 클라이언트의 IP 주소를 해시 값으로 변환하여 특정 서버로 요청을 보냅니다.

### 로드밸런서의 유형

로드밸런서는 사용 위치와 방식에 따라 여러 유형으로 분류됩니다:

1. **하드웨어 로드밸런서**: 전용 하드웨어 장비로, 고성능과 높은 신뢰성을 제공합니다. 대표적으로 F5 Networks의 Big-IP, Citrix의 NetScaler 등이 있습니다.
2. **소프트웨어 로드밸런서**: 일반 서버에서 동작하는 소프트웨어로, 설치와 관리가 비교적 용이합니다. 대표적으로 Nginx, HAProxy, Apache Traffic Server 등이 있습니다.
3. **클라우드 기반 로드밸런서**: 클라우드 서비스 제공자가 제공하는 로드밸런서로, 자동화와 유연성이 뛰어납니다. 대표적으로 AWS Elastic Load Balancing, Google Cloud Load Balancing, Azure Load Balancer 등이 있습니다.

### 로드밸런서의 장점

- **고가용성 및 장애 복구**: 장애가 발생한 서버를 자동으로 제외하고 정상 서버로 트래픽을 재분배하여 서비스 가용성을 유지합니다.
- **확장성**: 트래픽 증가에 따라 손쉽게 서버를 추가하고 트래픽을 분산할 수 있습니다.
- **보안 강화**: SSL 종료 및 기타 보안 기능을 통해 백엔드 서버의 보안을 강화할 수 있습니다.
- **성능 향상**: 부하 분산을 통해 각 서버의 성능을 최적화하고 응답 시간을 줄일 수 있습니다.

로드밸런서는 대규모 웹 애플리케이션에서 필수적인 컴포넌트로, 시스템의 신뢰성, 확장성, 성능을 극대화하는 데 중요한 역할을 합니다.

### 데이터베이스 병목 현상 해결법

1. **로컬 캐싱**: 각 서버 메모리에 데이터를 캐싱합니다.
2. **글로벌 캐싱**: 별도의 Redis 데이터베이스를 각 서버가 공유하도록 합니다.
3. **쿼리 튜닝**: 쿼리를 최적화하여 데이터베이스 성능을 향상시킵니다.

### 비동기 큐

비동기 큐는 대외 기관 연동을 비동기 스레드로 해결하기 위해 사용됩니다. 예를 들어 Kafka와 같은 메시지 큐 시스템을 사용할 수 있습니다.
