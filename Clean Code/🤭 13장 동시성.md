# 🤭 13장 동시성

## 동시성이 필요한 이유?

- 동시성 → 결합(coupling) 제거 전략
- 무엇과 언제를 분리하면 구조 및 효율 증가
- 서블릿은 웹 혹은 EJB 컨테이너라는 우산  아래서 돌아간다.
    - 웹 요청이 들어올 때마다 웹 서버는 비동기식으로 서블릿을 실행
    

## 미신과 오해

- 동시성은 항상 성능을 높여준다.
    - 처리할 독립적인 계산 많아야됨
- 동시성을 구현해도 설계는 변하지 않는다.
    - 단일 스레드 시스템과 다중 스레드 시스템은 설계가 판이하게 다르다
- 웹 또는 EJB 컨테이너를 사용하면 동시성을 이해할 필요가 없다.
    - 컨테이너 동작 원리, 어떻게 동시 수정, 데드락 문제 피하는 방법

### 의외로 올바른 생각

- 동시성은 부하를 유발
- 동시성은 복잡함
- 일반적으로 동시성 버그는 재현하기 어렵다. 그래서 진짜 결함으로 간주되지 않고 일회성 문제로 여겨 무시하기 쉽다.
- 동시성을 구현하려면 흔히 근본적인 설계 전략을 제고해야 한다.

## 동시성 방어 원칙

### 단일 책임 원칙 Single Responsibiltiy Principle, SRP

- 주어진 메서드/클래스/컴포넌트를 변경할 이유가 하나여야 한다.
- 동시성은 복잡성 하나만으로도 분리해야 된다.
- 동시성 코드는 다른 코드와 분리해야 된다.

### 따름 정리corollary: 자료 범위를 제한하라

- 공유 객체를 사용하는 코드 내 임계영역critical section을 synchronized 키워드로 보호해야된다.
- 자료를 캡슐화 하라
- 공유 자료를 최대한 줄여라

### 따름 정리: 자료 사본을 사용하라

- 처음부터 공유하지 않는 것이 좋다.

### 따름 정리: 스레드는 가능한 독립적으로 구현하라

- 다른 스레드와 자료를 공유하지 않는 스레드를 만들어라
- 독자적인 스레드로 가능하면 다른 프로세서에서 돌려도 괜찮도록 자료를 독립적인 단위로 분할하라
